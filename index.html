<html><head><base href="https://websim.com/racha-pelada-uniao/?">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Racha Pelada União - Sistema Interativo Aprimorado</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-color: #4CAF50;
  --secondary-color: #FFA000;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --info-color: #17a2b8;
  --light-color: #f8f9fa;
  --dark-color: #343a40;
  --font-family: 'Roboto', sans-serif;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-family);
  line-height: 1.6;
  color: var(--dark-color);
  background: linear-gradient(135deg, #f5f7fa 0%, #e0e8f0 100%);
  min-height: 100vh;
}

.container {
  max-width: 100%;
  padding: 1rem;
}

header {
  background-color: var(--primary-color);
  color: white;
  text-align: center;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

h1, h2 {
  margin-bottom: 0.5rem;
}

.card {
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  padding: 1rem;
  margin-bottom: 1rem;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.form-group {
  margin-bottom: 0.5rem;
}

label {
  display: block;
  margin-bottom: 0.25rem;
  font-weight: bold;
}

input[type="text"],
input[type="number"],
input[type="time"],
select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

input[type="text"]:focus,
input[type="number"]:focus,
input[type="time"]:focus,
select:focus {
  border-color: var(--primary-color);
  outline: none;
  box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.25);
}

button {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  border-radius: 4px;
  cursor: pointer;
  width: 100%;
  margin-top: 0.5rem;
  transition: background-color 0.3s ease, transform 0.1s ease;
}

button:hover {
  background-color: #45a049;
}

button:active {
  transform: scale(0.98);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: left;
}

th {
  background-color: var(--light-color);
  font-weight: bold;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

.team-lists {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-top: 1rem;
}

.team-list {
  flex: 1 1 48%;
  margin-bottom: 1rem;
  padding: 1rem;
}

.team-list h3 {
  text-align: center;
  margin-bottom: 0.5rem;
  color: white;
}

#blue-team {
  background-color: #007bff;
}

#orange-team {
  background-color: #fd7e14;
}

#blue-team-second {
  background-color: #007bff;
}

#orange-team-second {
  background-color: #fd7e14;
}

.team-list ul {
  list-style-type: none;
  padding: 0;
}

.team-list li {
  background-color: rgba(255, 255, 255, 0.8);
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  border-radius: 4px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  text-align: left;
}

.team-list li span {
  flex-grow: 1;
  text-align: left;
}

.team-list li::before {
  content: attr(data-number);
  margin-right: 0.5rem;
}

.totals {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-top: 1rem;
  font-weight: bold;
}

.totals p {
  flex: 1 1 30%;
  margin-bottom: 0.5rem;
}

footer {
  text-align: center;
  padding: 1rem;
  background-color: var(--secondary-color);
  color: white;
  margin-top: 1rem;
}

@media (min-width: 768px) {
  .container {
    max-width: 750px;
    margin: 0 auto;
  }

  .form-row {
    display: flex;
    justify-content: space-between;
  }

  .form-row .form-group {
    flex: 1;
    margin-right: 0.5rem;
  }

  .form-row .form-group:last-child {
    margin-right: 0;
  }
}

.edit-delete-buttons {
  display: flex;
  gap: 0.5rem;
}

.edit-btn, .delete-btn, .team-button {
  padding: 0.25rem 0.5rem;
  font-size: 0.8rem;
  width: auto;
}

.team-button {
  margin-right: 0.5rem;
}

.remove-btn {
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  line-height: 1;
  cursor: pointer;
  margin-left: 5px;
}
.remove-btn:hover {
  background-color: #c82333;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

.required-field::after {
  content: " *";
  color: red;
}

.goalkeeper-required::after {
  content: " *";
  color: red;
}

.nav-arrow {
  position: sticky;
  top: 50%;
  transform: translateY(-50%);
  z-index: 100;
  background-color: var(--primary-color);
  color: white;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 10px;
}

.time-navigation {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1rem;
}

@media (min-width: 768px) {
  th, td {
    padding: 8px;
    font-size: 1em;
  }
}

.team-button.blue-team-btn {
  background-color: #007bff;
  color: white;
}

.team-button.orange-team-btn {
  background-color: #fd7e14;
  color: white;
}

.edit-btn {
  background-color: #ffc107;
  color: black;
}

.delete-btn {
  background-color: #dc3545;
  color: white;
}

.edit-btn:hover, .delete-btn:hover, .team-button:hover {
  opacity: 0.8;
}

.form-group select {
  margin-bottom: 1rem;
  padding: 0.5rem;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 1rem;
  max-width: 200px;
}

.form-group select:focus {
  border-color: var(--primary-color);
  outline: none;
  box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.25);
}

#print-card-list td {
  vertical-align: top;
  width: 50%;
  padding: 10px;
}

#print-card-list .edit-delete-buttons {
  margin-top: 5px;
}

#print-card-list td:empty {
  background-color: #f8f9fa;
}

.print-btn {
  background-color: var(--info-color) !important;
}

.print-btn:hover {
  background-color: #138496 !important;
}

.clear-btn {
  background-color: var(--danger-color) !important;
}

.clear-btn:hover {
  background-color: #c82333 !important;
}
</style>
</head>
<body>
<header>
  <h1>Racha Pelada União</h1>
</header>

<div class="container">
  <div id="main-section">
    <div class="card fade-in">
      <h2>Data do Racha: <span id="game-date"></span></h2>
    </div>
    <div class="card fade-in">
      <h2>Cadastro do Jogador</h2>
      <form id="player-form">
        <div class="form-group">
          <label for="saved-players">Jogador Cadastrado:</label>
          <select id="saved-players">
            <option value="">Selecione um jogador ou cadastre um novo</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="player-name" class="required-field goalkeeper-required">Nome do Jogador:</label>
            <input type="text" id="player-name" required>
          </div>
          <div class="form-group">
            <label for="player-position" class="required-field goalkeeper-required">Posição:</label>
            <select id="player-position" required>
              <option value="">Selecione</option>
              <option value="Atacante">Atacante</option>
              <option value="Meia">Meia</option>
              <option value="Volante">Volante</option>
              <option value="Zagueiro">Zagueiro</option>
              <option value="Lateral">Lateral</option>
              <option value="Goleiro">Goleiro</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="player-type" class="required-field">Tipo:</label>
            <select id="player-type" required>
              <option value="">Selecione</option>
              <option value="Mensalista">Mensalista</option>
              <option value="Diarista">Diarista</option>
            </select>
          </div>
          <div class="form-group">
            <label for="arrival-time" class="required-field goalkeeper-required">Chegada:</label>
            <input type="time" id="arrival-time" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="amount-raised">Valor (R$):</label>
            <input type="number" id="amount-raised" step="0.01">
          </div>
          <div class="form-group">
            <label for="payment-method">Pagamento:</label>
            <select id="payment-method">
              <option value="">Selecione</option>
              <option value="Dinheiro">Dinheiro</option>
              <option value="Pix">Pix</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="payment-status">Status de Pagamento:</label>
            <select id="payment-status">
              <option value="">Selecione</option>
              <option value="Em Dias">Em Dias</option>
              <option value="Devendo">Devendo</option>
            </select>
          </div>
        </div>
        <button type="submit">Cadastrar Jogador</button>
      </form>
    </div>

    <div class="card fade-in">
      <h2>Lista de Ordem de Chegada</h2>
      <div class="form-group">
        <label for="arrival-position-filter">Filtrar por Posição:</label>
        <select id="arrival-position-filter">
          <option value="">Todas as Posições</option>
          <option value="Atacante">Atacante</option>
          <option value="Meia">Meia</option>
          <option value="Volante">Volante</option>
          <option value="Zagueiro">Zagueiro</option>
          <option value="Lateral">Lateral</option>
        </select>
      </div>
      <table id="arrival-list">
        <thead>
          <tr>
            <th>Nº</th>
            <th>Nome</th>
            <th>Posição</th>
            <th>Tipo</th>
            <th>Chegada</th>
            <th>Valor (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card fade-in">
      <h2>Lista de Goleiros</h2>
      <table id="goalkeeper-list">
        <thead>
          <tr>
            <th>Nº</th>
            <th>Nome</th>
            <th>Posição</th>
            <th>Chegada</th>
            <th>Valor (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card fade-in">
      <h2>Jogadores do Segundo Tempo</h2>
      <div class="form-group">
        <label for="substitute-position-filter">Filtrar por Posição:</label>
        <select id="substitute-position-filter">
          <option value="">Todas as Posições</option>
          <option value="Atacante">Atacante</option>
          <option value="Meia">Meia</option>
          <option value="Volante">Volante</option>
          <option value="Zagueiro">Zagueiro</option>
          <option value="Lateral">Lateral</option>
        </select>
      </div>
      <table id="substitute-list">
        <thead>
          <tr>
            <th>Nº</th>
            <th>Nome</th>
            <th>Posição</th>
            <th>Tipo</th>
            <th>Chegada</th>
            <th>Valor (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card fade-in">
      <div class="time-navigation">
        <button id="prev-time" class="nav-arrow">&lt;</button>
        <h2><span id="current-time">Times Primeiro Tempo</span></h2>
        <button id="next-time" class="nav-arrow">&gt;</button>
      </div>
      <div id="times-primeiro-tempo">
        <div class="team-lists">
          <div class="team-list" id="blue-team">
            <h3>Time Azul</h3>
            <ul></ul>
          </div>
          <div class="team-list" id="orange-team">
            <h3>Time Laranja</h3>  
            <ul></ul>
          </div>
        </div>
      </div>
      <div id="times-segundo-tempo" style="display: none;">
        <div class="team-lists">
          <div class="team-list" id="blue-team-second">
            <h3>Time Azul (2º Tempo)</h3>
            <ul></ul>
          </div>
          <div class="team-list" id="orange-team-second">
            <h3>Time Laranja (2º Tempo)</h3>
            <ul></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="card fade-in">
      <h2>Registro de Gols e Cartões</h2>
      <form id="goal-card-form">
        <div class="form-row">
          <div class="form-group">
            <label for="player-goal-card">Nome do Jogador:</label>
            <select id="player-goal-card" required>
              <option value="">Selecione o Jogador</option>
            </select>
          </div>
          <div class="form-group">
            <label for="goals-scored">Gols:</label>
            <input type="number" id="goals-scored" required>
          </div>
        </div>
        <div class="form-group">
          <label for="card-type">Tipo de Cartão:</label>
          <select id="card-type">
            <option value="">Selecione o Tipo de Cartão</option>
            <option value="Amarelo">Cartão Amarelo</option>
            <option value="Azul">Cartão Azul</option>
            <option value="Vermelho">Cartão Vermelho</option>
          </select>
        </div>
        <button type="submit">Registrar</button>
      </form>
      <table id="goal-card-list">
        <thead>
          <tr>
            <th style="background-color: #007bff; color: white;">Time Azul</th>
            <th style="background-color: #fd7e14; color: white;">Time Laranja</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card fade-in">
      <h2>Registro de Entradas e Despesas</h2>
      <form id="expense-form">
        <div class="form-row">
          <div class="form-group">
            <label for="transaction-type">Tipo:</label>
            <select id="transaction-type" required>
              <option value="">Selecione</option>
              <option value="entrada">Entrada</option>
              <option value="despesa">Despesa</option>
            </select>
          </div>
          <div class="form-group">
            <label for="expense-description">Descrição:</label>
            <input type="text" id="expense-description" required>
          </div>
          <div class="form-group">
            <label for="expense-value">Valor:</label>
            <input type="number" id="expense-value" step="0.01" required>
          </div>
        </div>
        <button type="submit">Cadastrar</button>
      </form>
      <table id="expense-list">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Descrição</th>
            <th>Valor</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card fade-in">
      <h2>Totais</h2>
      <div class="totals">
        <p>Entrada: R$ <span id="total-raised">0.00</span></p>
        <p>Saída: R$ <span id="total-expenses">0.00</span></p>
        <p>Total: R$ <span id="final-total">0.00</span></p>
      </div>
    </div>

    <div class="card fade-in">
      <button id="generate-report">Gerar Relatório</button>
      <button id="print-page" class="print-btn">Imprimir</button>
      <button id="clear-all-data" class="clear-btn">Limpar Todos os Dados</button>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2024 Racha Pelada União - Todos os direitos reservados.</p>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let currentTime = 'primeiro'; 
let totalRaised = 0;
let totalExpenses = 0;
let players = [];
let expenses = [];

let firstHalfTeams = {
  blue: [],
  orange: []
};

let secondHalfTeams = {
  blue: [],
  orange: []
};

const gameDate = new Date().toLocaleDateString('pt-BR');
document.getElementById('game-date').textContent = gameDate;

function savePlayerData() {
  const playerData = players.map(player => ({
    name: player.name,
    position: player.position,
    type: player.type
  }));
  localStorage.setItem('persistentPlayerData', JSON.stringify(playerData));
}

function loadPlayerData() {
  const storedData = localStorage.getItem('persistentPlayerData');
  if (storedData) {
    const data = JSON.parse(storedData);
    return data.sort((a, b) => a.name.localeCompare(b.name));
  }
  return [];
}

function saveTeamsData() {
  localStorage.setItem('firstHalfTeams', JSON.stringify(firstHalfTeams));
  localStorage.setItem('secondHalfTeams', JSON.stringify(secondHalfTeams));
}

function loadTeamsData() {
  const storedFirstHalfTeams = localStorage.getItem('firstHalfTeams');
  const storedSecondHalfTeams = localStorage.getItem('secondHalfTeams');

  if (storedFirstHalfTeams) {
    firstHalfTeams = JSON.parse(storedFirstHalfTeams);
  }

  if (storedSecondHalfTeams) {
    secondHalfTeams = JSON.parse(storedSecondHalfTeams);
  }

  updateTeamList('blue', true);
  updateTeamList('orange', true);
  updateTeamList('blue', false);
  updateTeamList('orange', false);
}

function saveData() {
  localStorage.setItem('players', JSON.stringify(players));
  localStorage.setItem('expenses', JSON.stringify(expenses));
  localStorage.setItem('totalRaised', totalRaised);
  localStorage.setItem('totalExpenses', totalExpenses);
}

function loadData() {
  const storedPlayers = localStorage.getItem('players');
  const storedExpenses = localStorage.getItem('expenses');
  const storedTotalRaised = localStorage.getItem('totalRaised');
  const storedTotalExpenses = localStorage.getItem('totalExpenses');

  if (storedPlayers) {
    players = JSON.parse(storedPlayers);
    players.forEach(player => {
      player.arrivalDate = new Date(`2000-01-01T${player.arrivalTime}`);
    });
  }
  if (storedExpenses) expenses = JSON.parse(storedExpenses);
  if (storedTotalRaised) totalRaised = parseFloat(storedTotalRaised);
  if (storedTotalExpenses) totalExpenses = parseFloat(storedTotalExpenses);

  loadTeamsData();

  updateSavedPlayersSelect();
  updatePlayerLists();
  updateTotals();
  updatePlayerSelect();
  updateGoalCardList();

  updateTeamList('blue', true);
  updateTeamList('orange', true);
  updateTeamList('blue', false);
  updateTeamList('orange', false);
}

loadData();

document.getElementById('arrival-position-filter').addEventListener('change', updatePlayerLists);
document.getElementById('substitute-position-filter').addEventListener('change', updatePlayerLists);

document.getElementById('clear-all-data').addEventListener('click', function() {
  if (confirm('Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita.')) {
    players = [];
    expenses = [];
    totalRaised = 0;
    totalExpenses = 0;
    
    firstHalfTeams = {
      blue: [],
      orange: []
    };
    
    secondHalfTeams = {
      blue: [],
      orange: []
    };
    
    updatePlayerLists();
    updateExpenseList();
    updateTotals();
    updateGoalCardList();
    updateTeamList('blue', true);
    updateTeamList('orange', true);
    updateTeamList('blue', false);
    updateTeamList('orange', false);
    
    localStorage.removeItem('players');
    localStorage.removeItem('expenses');
    localStorage.removeItem('totalRaised');
    localStorage.removeItem('totalExpenses');
    localStorage.removeItem('firstHalfTeams');
    localStorage.removeItem('secondHalfTeams');
    
    document.getElementById('player-form').reset();
    document.getElementById('goal-card-form').reset();
    document.getElementById('expense-form').reset();
    
    alert('Todos os dados foram limpos com sucesso!');
  }
});

document.getElementById('prev-time').addEventListener('click', function() {
  currentTime = 'primeiro';
  document.getElementById('current-time').textContent = 'Times Primeiro Tempo';
  document.getElementById('times-primeiro-tempo').style.display = 'block';
  document.getElementById('times-segundo-tempo').style.display = 'none';
  
  updateTeamList('blue', true);
  updateTeamList('orange', true);
});

document.getElementById('next-time').addEventListener('click', function() {
  currentTime = 'segundo';
  document.getElementById('current-time').textContent = 'Times Segundo Tempo';
  document.getElementById('times-primeiro-tempo').style.display = 'none';
  document.getElementById('times-segundo-tempo').style.display = 'block';

  if (secondHalfTeams.blue.length === 0 && secondHalfTeams.orange.length === 0) {
    secondHalfTeams.blue = JSON.parse(JSON.stringify(firstHalfTeams.blue));
    secondHalfTeams.orange = JSON.parse(JSON.stringify(firstHalfTeams.orange));
  }
  
  updateTeamList('blue', false);
  updateTeamList('orange', false);
});

function assignToTeam(player, team) {
  const isPrimeiroTempo = currentTime === 'primeiro';
  const teamList = document.getElementById(`${team}-team${isPrimeiroTempo ? '' : '-second'}`).getElementsByTagName('ul')[0];
  const otherTeam = team === 'blue' ? 'orange' : 'blue';
  const targetTeams = isPrimeiroTempo ? firstHalfTeams : secondHalfTeams;

  const existingInOtherTeam = targetTeams[otherTeam].findIndex(p => p.name === player.name);
  if (existingInOtherTeam !== -1) {
    targetTeams[otherTeam].splice(existingInOtherTeam, 1);
    updateTeamList(otherTeam, isPrimeiroTempo);
  }

  if (player.position === 'Goleiro') {
    if (targetTeams[team].some(p => p.position === 'Goleiro')) {
      alert('Este time já tem um goleiro.');
      return;
    }
  } else {
    const fieldPlayers = targetTeams[team].filter(p => p.position !== 'Goleiro').length;
    if (fieldPlayers >= 10) {
      alert('Este time já está completo para jogadores de linha.');
      return;
    }
  }

  if (!isPrimeiroTempo) {
    const substituteList = Array.from(document.getElementById('substitute-list').getElementsByTagName('tr'))
      .slice(1)
      .map(row => row.cells[1].textContent);

    const arrivalList = Array.from(document.getElementById('arrival-list').getElementsByTagName('tr'))
      .slice(1)
      .map(row => row.cells[1].textContent);

    const firstHalfPlayers = targetTeams[team]
      .filter(p => p.position !== 'Goleiro')
      .sort((a, b) => {
        return arrivalList.indexOf(b.name) - arrivalList.indexOf(a.name);
      });

    if (substituteList.length > 0 && !targetTeams[team].some(p => p.name === player.name)) {
      if (firstHalfPlayers.length >= 10) {
        const playerToRemove = firstHalfPlayers[firstHalfPlayers.length - 1];
        const removeIndex = targetTeams[team].findIndex(p => p.name === playerToRemove.name);
        if (removeIndex !== -1) {
          targetTeams[team].splice(removeIndex, 1);
        }
      }
    }
  }

  if (!targetTeams[team].some(p => p.name === player.name)) {
    targetTeams[team].push(player);
  }

  updateTeamList(team, isPrimeiroTempo);
  updatePlayerRowColor(player, team);
  saveTeamsData();
}

function updatePlayerLists() {
  const arrivalList = document.getElementById('arrival-list').getElementsByTagName('tbody')[0];
  const goalkeeperList = document.getElementById('goalkeeper-list').getElementsByTagName('tbody')[0];
  const substituteList = document.getElementById('substitute-list').getElementsByTagName('tbody')[0];

  const arrivalPositionFilter = document.getElementById('arrival-position-filter').value;
  const substitutePositionFilter = document.getElementById('substitute-position-filter').value;

  arrivalList.innerHTML = '';
  goalkeeperList.innerHTML = '';
  substituteList.innerHTML = '';

  const sortedPlayers = [...players].sort((a, b) => {
    const cutoffTime = new Date('2000-01-01T06:30:00');
    const aIsMensalista = a.type === 'Mensalista' && a.arrivalDate <= cutoffTime;
    const bIsMensalista = b.type === 'Mensalista' && b.arrivalDate <= cutoffTime;

    if (aIsMensalista && !bIsMensalista) {
      return -1;
    } else if (!aIsMensalista && bIsMensalista) {
      return 1;
    } else {
      return a.arrivalDate - b.arrivalDate;
    }
  });

  const goalkeepers = sortedPlayers.filter(p => p.position === 'Goleiro');
  let goalkeeperCount = 0;
  goalkeepers.forEach((player) => {
    addPlayerToList(player, goalkeeperList, goalkeeperCount + 1);
    goalkeeperCount++;
  });

  let arrivalCount = 0;
  let substituteCount = 0;

  sortedPlayers
    .filter(p => p.position !== 'Goleiro')
    .forEach((player, index) => {
      const matchesArrivalFilter = !arrivalPositionFilter || player.position === arrivalPositionFilter;
      const matchesSubstituteFilter = !substitutePositionFilter || player.position === substitutePositionFilter;

      if (arrivalCount < 20 && matchesArrivalFilter) {
        addPlayerToList(player, arrivalList, arrivalCount + 1);
        arrivalCount++;
      } else if (matchesSubstituteFilter) {
        addPlayerToList(player, substituteList, substituteCount + 1, 21);
        substituteCount++;
      }
    });
}

function updateSavedPlayersSelect() {
  const savedPlayersSelect = document.getElementById('saved-players');
  const persistentData = loadPlayerData();
  savedPlayersSelect.innerHTML = '<option value="">Selecione um jogador ou cadastre um novo</option>';

  persistentData.forEach(player => {
    const option = document.createElement('option');
    option.value = JSON.stringify(player);
    option.textContent = `${player.name} - ${player.position} - ${player.type}`;
    savedPlayersSelect.appendChild(option);
  });
}

document.getElementById('player-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const name = document.getElementById('player-name').value;
  const position = document.getElementById('player-position').value;
  const type = document.getElementById('player-type').value;
  const arrivalTime = document.getElementById('arrival-time').value;
  const arrivalDate = new Date(`2000-01-01T${arrivalTime}`);
  const amount = parseFloat(document.getElementById('amount-raised').value) || 0;
  const paymentMethod = document.getElementById('payment-method').value;
  const paymentStatus = document.getElementById('payment-status').value;

  if (position === 'Goleiro') {
    if (!name || !position || !arrivalTime) {
      alert('Para goleiros, Nome, Posição e Chegada são obrigatórios.');
      return;
    }
  } else {
    if (!name || !position || !type || !arrivalTime) {
      alert('Por favor, preencha todos os campos obrigatórios.');
      return;
    }
  }

  if (players.some(p => p.name === name)) {
    alert('Este jogador já está cadastrado. Não é permitido cadastrar o mesmo jogador duas vezes.');
    return;
  }

  const player = { 
    name, 
    position, 
    type, 
    arrivalTime, 
    arrivalDate, 
    amount, 
    paymentMethod, 
    paymentStatus 
  };
  players.push(player);

  if (paymentStatus === 'Em Dias') {
    totalRaised += amount;
  }
  updateTotals();
  updatePlayerLists();
  updateSavedPlayersSelect();
  updatePlayerSelect();
  savePlayerData();
  saveData();
  this.reset();
  saveTeamsData();
});

document.getElementById('saved-players').addEventListener('change', function() {
  const selectedPlayer = JSON.parse(this.value);
  if (selectedPlayer) {
    document.getElementById('player-name').value = selectedPlayer.name;
    document.getElementById('player-position').value = selectedPlayer.position;
    document.getElementById('player-type').value = selectedPlayer.type;
  } else {
    document.getElementById('player-form').reset();
  }
});

document.getElementById('player-position').addEventListener('change', function() {
  const isGoalkeeper = this.value === 'Goleiro';
  document.getElementById('player-type').disabled = isGoalkeeper;
  document.getElementById('amount-raised').disabled = isGoalkeeper;
  document.getElementById('payment-method').disabled = isGoalkeeper;
  document.getElementById('payment-status').disabled = isGoalkeeper;
});

function addPlayerToList(player, tableBody, index, startIndex = 1) {
  const row = tableBody.insertRow();

  if (player.position === 'Goleiro') {
    row.innerHTML = `
      <td>${index}</td>
      <td>${player.name}</td>
      <td>${player.position}</td>
      <td>${player.arrivalTime}</td>
      <td>R$ ${player.amount ? player.amount.toFixed(2) : '0.00'}</td>
    `;
  } else {
    row.innerHTML = `
      <td>${startIndex ? startIndex + index - 1 : index}</td>
      <td>${player.name}</td>
      <td>${player.position}</td>
      <td>${player.type === 'Mensalista' ? 'M' : 'D'}</td>
      <td>${player.arrivalTime}</td>
      <td>R$ ${player.amount ? player.amount.toFixed(2) : '0.00'}</td>
    `;
  }

  const actionsCell = row.insertCell();
  const buttonsDiv = document.createElement('div');
  buttonsDiv.classList.add('edit-delete-buttons');

  const editButton = document.createElement('button');
  editButton.textContent = 'Editar';
  editButton.classList.add('edit-btn');
  editButton.addEventListener('click', () => editPlayer(player, row));

  const deleteButton = document.createElement('button');
  deleteButton.textContent = 'Excluir';
  deleteButton.classList.add('delete-btn');
  deleteButton.addEventListener('click', () => deletePlayer(player, row));

  buttonsDiv.appendChild(editButton);
  buttonsDiv.appendChild(deleteButton);

  if (tableBody.parentElement.id === 'arrival-list' || 
      tableBody.parentElement.id === 'goalkeeper-list' || 
      tableBody.parentElement.id === 'substitute-list') {
    const blueTeamButton = document.createElement('button');
    blueTeamButton.textContent = 'Azul';
    blueTeamButton.classList.add('team-button', 'blue-team-btn');
    blueTeamButton.addEventListener('click', () => assignToTeam(player, 'blue'));

    const orangeTeamButton = document.createElement('button');
    orangeTeamButton.textContent = 'Laranja';
    orangeTeamButton.classList.add('team-button', 'orange-team-btn');
    orangeTeamButton.addEventListener('click', () => assignToTeam(player, 'orange'));

    buttonsDiv.appendChild(blueTeamButton);
    buttonsDiv.appendChild(orangeTeamButton);
  }

  actionsCell.appendChild(buttonsDiv);
}

let blueTeamCount = 0;
let orangeTeamCount = 0;
let blueGoalkeeper = false;
let orangeGoalkeeper = false;
let blueTeamCountSecond = 0;
let orangeTeamCountSecond = 0;
let blueGoalkeeperSecond = false;
let orangeGoalkeeperSecond = false;

function updateTeamList(team, isPrimeiroTempo) {
  const teamList = document.getElementById(`${team}-team${isPrimeiroTempo ? '' : '-second'}`).getElementsByTagName('ul')[0];
  teamList.innerHTML = '';

  const targetTeams = isPrimeiroTempo ? firstHalfTeams : secondHalfTeams;

  const sortedPlayers = [...targetTeams[team]].sort((a, b) => {
    const playerA = players.find(p => p.name === a.name);
    const playerB = players.find(p => p.name === b.name);

    if (playerA.position === 'Goleiro' && playerB.position !== 'Goleiro') return -1;
    if (playerA.position !== 'Goleiro' && playerB.position === 'Goleiro') return 1;
    
    return targetTeams[team].indexOf(a) - targetTeams[team].indexOf(b);
  });

  sortedPlayers.forEach((player, index) => {
    const li = document.createElement('li');
    li.setAttribute('data-number', index + 1);

    const playerData = players.find(p => p.name === player.name);
    let playerNumber = '-';
    
    const arrivalList = Array.from(document.getElementById('arrival-list').getElementsByTagName('tr')).slice(1);
    const substituteList = Array.from(document.getElementById('substitute-list').getElementsByTagName('tr')).slice(1);
    
    for(let i = 0; i < arrivalList.length; i++) {
      if(arrivalList[i].cells[1].textContent === player.name) {
        playerNumber = i + 1;
        break;
      }
    }
    
    if(playerNumber === '-') {
      for(let i = 0; i < substituteList.length; i++) {
        if(substituteList[i].cells[1].textContent === player.name) {
          playerNumber = i + 21;
          break;
        }
      }
    }

    const playerSpan = document.createElement('span');
    playerSpan.textContent = `${player.name} - ${playerData.position}`;
    li.appendChild(playerSpan);

    const numberCircle = document.createElement('span');
    numberCircle.textContent = playerNumber;
    numberCircle.style.backgroundColor = '#fff';
    numberCircle.style.borderRadius = '50%';
    numberCircle.style.padding = '2px 6px';
    numberCircle.style.marginRight = '5px';
    numberCircle.style.border = '1px solid #000';
    numberCircle.style.fontSize = '12px';

    const removeButton = document.createElement('button');
    removeButton.textContent = 'X';
    removeButton.classList.add('remove-btn');
    removeButton.addEventListener('click', () => removeFromTeam(player, team, isPrimeiroTempo));

    const buttonContainer = document.createElement('div');
    buttonContainer.style.display = 'flex';
    buttonContainer.style.alignItems = 'center';
    buttonContainer.appendChild(numberCircle);
    buttonContainer.appendChild(removeButton);
    
    li.appendChild(buttonContainer);
    teamList.appendChild(li);
  });
}

function removeFromTeam(player, team, isPrimeiroTempo) {
  const targetTeams = isPrimeiroTempo ? firstHalfTeams : secondHalfTeams;
  const index = targetTeams[team].findIndex(p => p.name === player.name);

  if (index !== -1) {
    targetTeams[team].splice(index, 1);
    updateTeamList(team, isPrimeiroTempo);
    updatePlayerRowColor(player, null);
    saveTeamsData();
  }
}

function updatePlayerRowColor(player, team) {
  const tables = [
    document.getElementById('arrival-list'),
    document.getElementById('goalkeeper-list'),
    document.getElementById('substitute-list')
  ];

  tables.forEach(table => {
    const rows = table.getElementsByTagName('tr');
    for (let row of rows) {
      if (row.cells[1] && row.cells[1].textContent === player.name) {
        row.style.backgroundColor = team ? (team === 'blue' ? '#cce5ff' : '#ffeeba') : '';
        break;
      }
    }
  });
}

function editPlayer(player, row) {
  document.getElementById('player-name').value = player.name;
  document.getElementById('player-position').value = player.position;
  document.getElementById('player-type').value = player.type;
  document.getElementById('arrival-time').value = player.arrivalTime;
  document.getElementById('amount-raised').value = player.amount || '';
  document.getElementById('payment-method').value = player.paymentMethod || '';
  document.getElementById('payment-status').value = player.paymentStatus || '';

  const index = players.indexOf(player);
  if (index > -1) {
    players.splice(index, 1);
    if (player.paymentStatus === 'Em Dias') {
      totalRaised -= player.amount;
    }
    updateTotals();
    updatePlayerLists();
    updatePlayerSelect();
  }

  row.remove();
  document.getElementById('player-name').focus();
}

function deletePlayer(player, row) {
  if (confirm(`Tem certeza que deseja excluir ${player.name}?`)) {
    const index = players.indexOf(player);
    if (index > -1) {
      players.splice(index, 1);
      if (player.paymentStatus === 'Em Dias') {
        totalRaised -= player.amount;
      }
      updateTotals();
      updatePlayerLists();
      updatePlayerSelect();
      saveData();
    }
    row.remove();
  }
}

function updatePlayerSelect() {
  const select = document.getElementById('player-goal-card');
  select.innerHTML = '<option value="">Selecione o Jogador</option>';
  players.forEach(player => {
    const option = document.createElement('option');
    option.value = player.name;
    option.textContent = player.name;
    select.appendChild(option);
  });
}

document.getElementById('goal-card-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const playerName = document.getElementById('player-goal-card').value;
  const goals = parseInt(document.getElementById('goals-scored').value);
  const cardType = document.getElementById('card-type').value;

  if (!playerName || isNaN(goals)) {
    alert('Por favor, selecione um jogador e preencha o número de gols corretamente.');
    return;
  }

  const player = players.find(p => p.name === playerName);
  if (player) {
    let playerTeam = null;
    let isPrimeiroTempo = false;

    if (firstHalfTeams.blue.find(p => p.name === playerName)) {
      playerTeam = 'blue';
      isPrimeiroTempo = true;
    } else if (firstHalfTeams.orange.find(p => p.name === playerName)) {
      playerTeam = 'orange';
      isPrimeiroTempo = true;
    } else if (secondHalfTeams.blue.find(p => p.name === playerName)) {
      playerTeam = 'blue';
      isPrimeiroTempo = false;
    } else if (secondHalfTeams.orange.find(p => p.name === playerName)) {
      playerTeam = 'orange';
      isPrimeiroTempo = false;
    }

    if (!playerTeam) {
      alert('O jogador precisa estar em um time para registrar gols!');
      return;
    }

    player.goals = (player.goals || 0) + goals;
    if (cardType) {
      player.card = cardType;
    }

    updatePlayerStats(player);
    updateGoalCardList();
    saveData();
  } else {
    alert('Jogador não encontrado!');
  }
  this.reset();
});

function updatePlayerStats(player) {
  const teamLists = [
    document.getElementById('blue-team').getElementsByTagName('ul')[0],
    document.getElementById('orange-team').getElementsByTagName('ul')[0],
    document.getElementById('blue-team-second').getElementsByTagName('ul')[0],
    document.getElementById('orange-team-second').getElementsByTagName('ul')[0]
  ];
  teamLists.forEach(list => {
    const playerItem = Array.from(list.children).find(li => li.textContent.includes(player.name));
    if (playerItem) {
      playerItem.textContent = `${player.name} - ${player.position}`;
    }
  });
}

function updateGoalCardList() {
  const tableBody = document.getElementById('goal-card-list').getElementsByTagName('tbody')[0];
  tableBody.innerHTML = '';
  
  let blueTeamPlayers = [];
  let orangeTeamPlayers = [];
  let blueTeamGoals = 0;
  let orangeTeamGoals = 0;
  
  players.forEach(player => {
    if (player.goals || player.card) {
      if (firstHalfTeams.blue.find(p => p.name === player.name) || 
          secondHalfTeams.blue.find(p => p.name === player.name)) {
        blueTeamPlayers.push(player);
        blueTeamGoals += player.goals || 0;
      } else if (firstHalfTeams.orange.find(p => p.name === player.name) || 
                 secondHalfTeams.orange.find(p => p.name === player.name)) {
        orangeTeamPlayers.push(player);
        orangeTeamGoals += player.goals || 0;
      }
    }
  });
  
  const totalRow = tableBody.insertRow();
  const blueTotalCell = totalRow.insertCell();
  const orangeTotalCell = totalRow.insertCell();
  
  blueTotalCell.style.backgroundColor = '#cce5ff';
  blueTotalCell.style.fontWeight = 'bold';
  blueTotalCell.textContent = `Total de Gols: ${blueTeamGoals}`;
  
  orangeTotalCell.style.backgroundColor = '#ffeeba';
  orangeTotalCell.style.fontWeight = 'bold';
  orangeTotalCell.textContent = `Total de Gols: ${orangeTeamGoals}`;
  
  const separatorRow = tableBody.insertRow();
  const blueSpace = separatorRow.insertCell();
  const orangeSpace = separatorRow.insertCell();
  blueSpace.style.height = '10px';
  orangeSpace.style.height = '10px';
  
  const maxRows = Math.max(blueTeamPlayers.length, orangeTeamPlayers.length);
  
  for (let i = 0; i < maxRows; i++) {
    const row = tableBody.insertRow();
    
    if (i < blueTeamPlayers.length) {
      const player = blueTeamPlayers[i];
      const blueCell = row.insertCell();
      blueCell.style.backgroundColor = '#cce5ff';
      blueCell.innerHTML = `
        ${player.name} - Gols: ${player.goals || 0}${player.card ? ` - ${player.card}` : ''}
        <div class="edit-delete-buttons">
          <button class="edit-btn" onclick='editGoalCard(${JSON.stringify(JSON.stringify(player))})'>Editar</button>
          <button class="delete-btn" onclick='deleteGoalCard(${JSON.stringify(JSON.stringify(player))})'>Excluir</button>
        </div>
      `;
    } else {
      row.insertCell().innerHTML = '-';
    }
    
    if (i < orangeTeamPlayers.length) {
      const player = orangeTeamPlayers[i];
      const orangeCell = row.insertCell();
      orangeCell.style.backgroundColor = '#ffeeba';
      orangeCell.innerHTML = `
        ${player.name} - Gols: ${player.goals || 0}${player.card ? ` - ${player.card}` : ''} 
        <div class="edit-delete-buttons">
          <button class="edit-btn" onclick='editGoalCard(${JSON.stringify(JSON.stringify(player))})'>Editar</button>
          <button class="delete-btn" onclick='deleteGoalCard(${JSON.stringify(JSON.stringify(player))})'>Excluir</button>
        </div>
      `;
    } else {
      row.insertCell().innerHTML = '-';
    }
  }
}

function editGoalCard(playerStr) {
  const player = JSON.parse(playerStr);
  document.getElementById('player-goal-card').value = player.name;
  document.getElementById('goals-scored').value = player.goals || 0;
  document.getElementById('card-type').value = player.card || '';
}

function deleteGoalCard(playerStr) {
  const player = JSON.parse(playerStr);
  if (confirm(`Tem certeza que deseja excluir o registro de ${player.name}?`)) {
    const realPlayer = players.find(p => p.name === player.name);
    if (realPlayer) {
      delete realPlayer.goals;
      delete realPlayer.card;
      updateGoalCardList();
      updatePlayerStats(realPlayer);
      saveData();
    }
  }
}

document.getElementById('expense-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const type = document.getElementById('transaction-type').value;
  const description = document.getElementById('expense-description').value;
  const value = parseFloat(document.getElementById('expense-value').value);

  if (!type || !description || isNaN(value)) {
    alert('Por favor, preencha todos os campos corretamente.');
    return;
  }

  const expenseValue = Math.abs(value);
  
  expenses.push({ type, description, value: expenseValue });
  updateTotals();
  updateExpenseList();
  saveData();

  alert(`${type === 'entrada' ? 'Entrada' : 'Despesa'} registrada: ${description} - R$ ${expenseValue.toFixed(2)}`);
  this.reset();
});

function updateExpenseList() {
  const tableBody = document.getElementById('expense-list').getElementsByTagName('tbody')[0];
  tableBody.innerHTML = '';
  
  expenses.forEach((expense, index) => {
    const row = tableBody.insertRow();
    row.style.backgroundColor = expense.type === 'entrada' ? '#d4edda' : '#f8d7da';
    
    row.innerHTML = `
      <td>${expense.type === 'entrada' ? 'Entrada' : 'Despesa'}</td>
      <td>${expense.description}</td>
      <td>R$ ${Math.abs(expense.value).toFixed(2)}</td>
    `;
    
    const actionsCell = row.insertCell();
    const editButton = document.createElement('button');
    editButton.textContent = 'Editar';
    editButton.classList.add('edit-btn');
    editButton.addEventListener('click', () => editExpense(expense));
    
    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Excluir';
    deleteButton.classList.add('delete-btn');
    deleteButton.addEventListener('click', () => deleteExpense(index));
    
    actionsCell.appendChild(editButton);
    actionsCell.appendChild(deleteButton);
  });
}

function editExpense(expense) {
  document.getElementById('transaction-type').value = expense.type;
  document.getElementById('expense-description').value = expense.description;
  document.getElementById('expense-value').value = Math.abs(expense.value);
}

function deleteExpense(index) {
  if (confirm('Tem certeza que deseja excluir esta despesa?')) {
    expenses.splice(index, 1);
    updateExpenseList();
    updateTotals();
    saveData();
  }
}

function updateTotals() {
  totalRaised = players
    .filter(player => player.paymentStatus === 'Em Dias')
    .reduce((sum, player) => sum + (player.amount || 0), 0);

  let totalIncome = expenses
    .filter(exp => exp.type === 'entrada')
    .reduce((sum, exp) => sum + exp.value, 0);
    
  let totalExpense = expenses
    .filter(exp => exp.type === 'despesa')
    .reduce((sum, exp) => sum + Math.abs(exp.value), 0);

  let finalTotal = (totalRaised + totalIncome) - totalExpense;

  document.getElementById('total-raised').textContent = (totalRaised + totalIncome).toFixed(2);
  document.getElementById('total-expenses').textContent = totalExpense.toFixed(2);
  document.getElementById('final-total').textContent = finalTotal.toFixed(2);
}

document.getElementById('generate-report').addEventListener('click', function() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  let yPos = 10;
  const leftMargin = 10;
  const pageWidth = doc.internal.pageSize.width;
  
  doc.setFontSize(16);
  doc.text("RACHA PELADA UNIÃO", pageWidth / 2, yPos, { align: 'center' });
  yPos += 8;
  doc.setFontSize(12);
  doc.text(`Data: ${gameDate}`, pageWidth / 2, yPos, { align: 'center' });
  yPos += 15;

  function createTableHeader(headers, y) {
    doc.setFillColor(200, 200, 200);
    doc.rect(leftMargin, y - 5, pageWidth - 20, 7, 'F');
    doc.text(headers.join('   '), leftMargin, y);
    return y + 8;
  }

  doc.setFontSize(14);
  doc.text("Lista de Ordem de Chegada", leftMargin, yPos);
  yPos += 8;
  
  doc.setFontSize(10);
  doc.setDrawColor(0);
  doc.setFillColor(230, 230, 230);
  yPos = createTableHeader(['Nome', 'Posição', 'Tipo', 'Chegada', 'Valor'], yPos);
  
  players
    .filter(p => p.position !== 'Goleiro')
    .slice(0, 20)
    .forEach((player, idx) => {
      if (idx % 2 === 0) {
        doc.setFillColor(240, 240, 240);
        doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
      }
      const row = [
        player.name,
        player.position,
        player.type,
        player.arrivalTime,
        `R$ ${player.amount?.toFixed(2) || '0.00'}`
      ];
      doc.text(row.join('   '), leftMargin, yPos);
      yPos += 6;
      
      if (yPos > 280) {
        doc.addPage();
        yPos = 10;
      }
    });
  
  yPos += 10;
  doc.setFontSize(14);
  doc.text("Lista de Goleiros", leftMargin, yPos);
  yPos += 8;
  
  doc.setFontSize(10);
  doc.setFillColor(230, 230, 230);
  yPos = createTableHeader(['Nome', 'Chegada'], yPos);
  
  players
    .filter(p => p.position === 'Goleiro')
    .forEach((player, idx) => {
      if (idx % 2 === 0) {
        doc.setFillColor(240, 240, 240);
        doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
      }
      doc.text(`${player.name}   ${player.arrivalTime}`, leftMargin, yPos);
      yPos += 6;
      
      if (yPos > 280) {
        doc.addPage();
        yPos = 10;
      }
    });
  
  yPos += 10;
  doc.setFontSize(14);
  doc.text("Jogadores do Segundo Tempo", leftMargin, yPos);
  yPos += 8;
  
  doc.setFontSize(10);
  doc.setFillColor(230, 230, 230);
  yPos = createTableHeader(['Nome', 'Posição', 'Tipo', 'Chegada', 'Valor'], yPos);
  
  players
    .filter(p => p.position !== 'Goleiro')
    .slice(20)
    .forEach((player, idx) => {
      if (idx % 2 === 0) {
        doc.setFillColor(240, 240, 240);
        doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
      }
      const row = [
        player.name,
        player.position,
        player.type,
        player.arrivalTime,
        `R$ ${player.amount?.toFixed(2) || '0.00'}`
      ];
      doc.text(row.join('   '), leftMargin, yPos);
      yPos += 6;
      
      if (yPos > 280) {
        doc.addPage();
        yPos = 10;
      }
    });

  yPos += 10;
  if (yPos > 240) {
    doc.addPage();
    yPos = 10;
  }

  doc.setFontSize(14);
  doc.text("Times Primeiro Tempo", leftMargin, yPos);
  yPos += 8;
  
  const midPage = pageWidth / 2;
  
  doc.setFillColor(204, 229, 255);
  doc.rect(leftMargin, yPos - 5, midPage - 15, 7, 'F');
  doc.text("Time Azul", leftMargin, yPos);
  
  doc.setFillColor(255, 238, 186);
  doc.rect(midPage, yPos - 5, midPage - 15, 7, 'F');
  doc.text("Time Laranja", midPage, yPos);
  yPos += 8;

  const maxFirstHalf = Math.max(firstHalfTeams.blue.length, firstHalfTeams.orange.length);
  for(let i = 0; i < maxFirstHalf; i++) {
    if (i % 2 === 0) {
      doc.setFillColor(240, 240, 240);
      doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
    }
    
    if(firstHalfTeams.blue[i]) {
      const player = players.find(p => p.name === firstHalfTeams.blue[i].name);
      const text = `${player.name} - ${player.position}${player.goals ? ` - Gols: ${player.goals}` : ''}${player.card ? ` - ${player.card}` : ''}`;
      doc.text(text, leftMargin, yPos);
    }
    if(firstHalfTeams.orange[i]) {
      const player = players.find(p => p.name === firstHalfTeams.orange[i].name);
      const text = `${player.name} - ${player.position}${player.goals ? ` - Gols: ${player.goals}` : ''}${player.card ? ` - ${player.card}` : ''}`;
      doc.text(text, midPage, yPos);
    }
    yPos += 6;
    
    if (yPos > 280) {
      doc.addPage();
      yPos = 10;
    }
  }

  yPos += 10;
  if (yPos > 240) {
    doc.addPage();
    yPos = 10;
  }

  doc.setFontSize(14);
  doc.text("Times Segundo Tempo", leftMargin, yPos);
  yPos += 8;
  
  doc.setFillColor(204, 229, 255);
  doc.rect(leftMargin, yPos - 5, midPage - 15, 7, 'F');
  doc.text("Time Azul", leftMargin, yPos);
  
  doc.setFillColor(255, 238, 186);
  doc.rect(midPage, yPos - 5, midPage - 15, 7, 'F');
  doc.text("Time Laranja", midPage, yPos);
  yPos += 8;

  const maxSecondHalf = Math.max(secondHalfTeams.blue.length, secondHalfTeams.orange.length);
  for(let i = 0; i < maxSecondHalf; i++) {
    if (i % 2 === 0) {
      doc.setFillColor(240, 240, 240);
      doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
    }
    
    if(secondHalfTeams.blue[i]) {
      const player = players.find(p => p.name === secondHalfTeams.blue[i].name);
      const text = `${player.name} - ${player.position}${player.goals ? ` - Gols: ${player.goals}` : ''}${player.card ? ` - ${player.card}` : ''}`;
      doc.text(text, leftMargin, yPos);
    }
    if(secondHalfTeams.orange[i]) {
      const player = players.find(p => p.name === secondHalfTeams.orange[i].name);
      const text = `${player.name} - ${player.position}${player.goals ? ` - Gols: ${player.goals}` : ''}${player.card ? ` - ${player.card}` : ''}`;
      doc.text(text, midPage, yPos);
    }
    yPos += 6;
    
    if (yPos > 280) {
      doc.addPage();
      yPos = 10;
    }
  }

  yPos += 10;
  if (yPos > 240) {
    doc.addPage();
    yPos = 10;
  }

  doc.setFontSize(14);
  doc.text("Registro de Gols e Cartões", leftMargin, yPos);
  yPos += 8;

  let blueTeamGoals = 0;
  let orangeTeamGoals = 0;
  
  players.forEach(player => {
    if (player.goals) {
      if (firstHalfTeams.blue.find(p => p.name === player.name) || 
          secondHalfTeams.blue.find(p => p.name === player.name)) {
        blueTeamGoals += player.goals;
      } else if (firstHalfTeams.orange.find(p => p.name === player.name) || 
                 secondHalfTeams.orange.find(p => p.name === player.name)) {
        orangeTeamGoals += player.goals;
      }
    }
  });

  doc.setFillColor(204, 229, 255);
  doc.rect(leftMargin, yPos - 5, midPage - 15, 7, 'F');
  doc.text(`Time Azul - Total de Gols: ${blueTeamGoals}`, leftMargin, yPos);
  
  doc.setFillColor(255, 238, 186);
  doc.rect(midPage, yPos - 5, midPage - 15, 7, 'F');
  doc.text(`Time Laranja - Total de Gols: ${orangeTeamGoals}`, midPage, yPos);
  yPos += 8;

  const blueTeamPlayers = players.filter(p => 
    (p.goals || p.card) && 
    (firstHalfTeams.blue.find(bp => bp.name === p.name) || 
     secondHalfTeams.blue.find(bp => bp.name === p.name))
  );

  const orangeTeamPlayers = players.filter(p => 
    (p.goals || p.card) && 
    (firstHalfTeams.orange.find(bp => bp.name === p.name) || 
     secondHalfTeams.orange.find(bp => bp.name === p.name))
  );

  const maxPlayers = Math.max(blueTeamPlayers.length, orangeTeamPlayers.length);
  
  for(let i = 0; i < maxPlayers; i++) {
    if (i % 2 === 0) {
      doc.setFillColor(240, 240, 240);
      doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
    }
    
    if(blueTeamPlayers[i]) {
      const text = `${blueTeamPlayers[i].name} - Gols: ${blueTeamPlayers[i].goals || 0}${blueTeamPlayers[i].card ? ` - ${blueTeamPlayers[i].card}` : ''}`;
      doc.text(text, leftMargin, yPos);
    }
    if(orangeTeamPlayers[i]) {
      const text = `${orangeTeamPlayers[i].name} - Gols: ${orangeTeamPlayers[i].goals || 0}${orangeTeamPlayers[i].card ? ` - ${orangeTeamPlayers[i].card}` : ''}`;
      doc.text(text, midPage, yPos);
    }
    yPos += 6;
    
    if (yPos > 280) {
      doc.addPage();
      yPos = 10;
    }
  }

  yPos += 10;
  if (yPos > 240) {
    doc.addPage();
    yPos = 10;
  }

  doc.setFontSize(14);
  doc.text("Registro de Entradas e Despesas", leftMargin, yPos);
  yPos += 8;
  
  doc.setFontSize(10);
  doc.setFillColor(230, 230, 230);
  yPos = createTableHeader(['Tipo', 'Descrição', 'Valor'], yPos);

  expenses.forEach((expense, idx) => {
    if (idx % 2 === 0) {
      doc.setFillColor(240, 240, 240);
      doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
    }
    const row = [
      expense.type === 'entrada' ? 'Entrada' : 'Despesa',
      expense.description,
      `R$ ${Math.abs(expense.value).toFixed(2)}`
    ];
    doc.text(row.join('   '), leftMargin, yPos);
    yPos += 6;
    
    if (yPos > 280) {
      doc.addPage();
      yPos = 10;
    }
  });

  yPos += 10;
  if (yPos > 240) {
    doc.addPage();
    yPos = 10;
  }

  doc.setFontSize(14);
  doc.text("Totais", leftMargin, yPos);
  yPos += 8;

  doc.setFontSize(10);
  
  const totalIncome = players
    .filter(player => player.paymentStatus === 'Em Dias')
    .reduce((sum, player) => sum + (player.amount || 0), 0) + 
    expenses
    .filter(exp => exp.type === 'entrada')
    .reduce((sum, exp) => sum + exp.value, 0);

  const totalExpenses = expenses
    .filter(exp => exp.type === 'despesa')
    .reduce((sum, exp) => sum + Math.abs(exp.value), 0);

  const finalTotal = totalIncome - totalExpenses;

  doc.setFillColor(230, 230, 230);
  yPos = createTableHeader(['Descrição', 'Valor'], yPos);
  
  const totalsRows = [
    ['Total de Entradas', `R$ ${totalIncome.toFixed(2)}`],
    ['Total de Saídas', `R$ ${totalExpenses.toFixed(2)}`],
    ['Total Final', `R$ ${finalTotal.toFixed(2)}`]
  ];

  totalsRows.forEach((row, idx) => {
    if (idx % 2 === 0) {
      doc.setFillColor(240, 240, 240);
      doc.rect(leftMargin, yPos - 5, pageWidth - 20, 7, 'F');
    }
    doc.text(row.join('   '), leftMargin, yPos);
    yPos += 6;
  });

  doc.save(`relatorio_racha_${gameDate.replace(/\//g, '-')}.pdf`);
});

// Print page functionality
document.getElementById('print-page').addEventListener('click', function() {
  window.print();
});
</script>
</body>
</html>
